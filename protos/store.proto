syntax = "proto3";

import "google/protobuf/empty.proto";
package store;

message GetObjectRequest {
    string ref = 1; // reference to the object to retrieve
}

message GetObjectResponse {
    bytes data = 1; // serialized object data
    string error = 2; // error message, if any
}

message PutObjectRequest {
    bytes data = 1; // serialized object data to store
    string key = 2; // optional key for the object
}

message PutObjectResponse {
    string ref = 1; // reference to the stored object
    string error = 2; // error message, if any
}

message Publish {
    string ref = 2;
}


service StoreService {
    rpc GetObject(GetObjectRequest) returns (GetObjectResponse) {}
    rpc PutObject(PutObjectRequest) returns (PutObjectResponse) {}
    // Publish is a server-streaming RPC: client sends an empty request and the server
    // continuously streams `Publish` messages (worker_id + ref) to the client.
    rpc PublishSession(google.protobuf.Empty) returns (stream Publish) {}
}